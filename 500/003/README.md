# 003

遵循**依赖倒置原则**实现的架构：

六边形架构



![six](image/six.png)







分层参考洋葱架构

![onion](image/onion.png)



`Tests`可以用于在不依赖外部服务的情况下，对业务领域逻辑进行测试，只需要在依赖注入时将真实的服务替换成Tests。

领域层理论上不会与任何具体的技术实现相耦合，只依赖接口，接口通过最外层注入。通过依赖注入的接口要注意并发性，因为注入的肯定只是一个单例的实例，最好不要有与实例状态相关的操作，注入的实例只作为一个媒介。

以仓储为例，接口定义在领域层，具体的实现放在基础设施层，即适配器模式。可以有多个适配器，比如mysql适配器、内存适配器。

另外需要明确，在应对软件复杂性变化上有两个层面：

1. 核心领域发生变化， DDD的作用就是简化各种复杂性变化带来的高耦合等问题，使用DDD可以应对这种变化
2. 核心领域不变的情况下，实现不同形态。即业务逻辑不变的情况，该模型应对的是核心**领域模型**稳定，扩展不同适配器的场景。



对于像go这种支持包测试的，测试文件和当前包放在一起，但是包名不一样，而且在层级上属于最外层。如下

![hierarchy](image/hierarchy.drawio.png)



对于每层的任务职责和边界要清晰、明确。不能为了方便把不适合本层做的放在本层，不适合的就上移一层、以此类推。



对于使用者，例如main，先以层初始化，再以功能初始化。因为每个功能（聚合）会用到多个层，依赖已初始化的层。







## FAQ





## reference

1. [map types](https://golang.google.cn/ref/spec#Map_types)
